<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>

<body>
    <script>
    var treeNodes = [{
        name: "四川我要去哪儿科技股份有限公司",
        pId: 0,
        id: 1
    }, {
        name: "差旅平台事业部",
        pId: 1,
        id: 2
    }, {
        name: "人力行政中心",
        pId: 1,
        id: 3
    }, {
        name: "技术中心",
        pId: 1,
        id: 4
    }, {
        name: "国内机票组",
        pId: 2,
        id: 5
    }, {
        name: "增值业务组",
        pId: 2,
        id: 6
    }, {
        name: "差旅产品组",
        pId: 2,
        id: 7
    }, {
        name: "差旅测试部",
        pId: 2,
        id: 8
    }, {
        name: "test",
        checked: true,
        pId: 2,
        id: 9
    }, {
        name: "人力资源部",
        pId: 3,
        id: 10
    }, {
        name: "后勤部",
        pId: 3,
        id: 11
    }, {
        name: "Web前端研发部",
        checked: true,
        pId: 4,
        id: 12
    }, {
        name: "123456",
        data: {
            'a': 1,
            'b': 2
        },
        pId: 9,
        id: 13
    }, {
        name: 'joe',
        pId: 12,
        id: 14
    }, {
        name: '前端酒店开发组',
        pId: 12,
        id: 15
    }, {
        name: 'haha',
        pId: 15,
        id: 16
    }];

    (function(expandLevel, treeNodes) {
        var level = 0;
        function _findChildren(list, p_id) { //数据层级化，
            var r = [];
            p_id = p_id != undefined ? p_id : undefined;
            level++;
            list.forEach(function(item, i) {
                if (item.pId == p_id) {
                    if (level <= expandLevel) {
                        item.open = true;
                    }
                    var length = r.length;
                    r[length] = item;
                    var t = _findChildren(list, item.id);
                    if (t.length) {
                        r[length].children = t;
                    }
                }
            });
            level--;
            return r;
        }
        console.log(treeNodes);
        var treeNodes = _findChildren(treeNodes, 0);
        console.log(treeNodes);
    })(3, treeNodes);
    // console.log(treeNodes);

    var level = 1;
    var stack = [];
    // treeNodes.forEach(function(node, i) {
    //     (function(node) {
    //         stack.push(node);
    //         // level++;
    //         var pid = node.pId;
    //         while (stack.length) {
    //             node = stack.shift();

    //             if (pid != node.pId) {
    //                 level++;
    //                 pid = node.pId;
    //             }

    //             if (level <= expandLevel) {
    //                 node.open = true;
    //             }
    //             if (!!node.children) {
    //                 Array.prototype.push.apply(stack, node.children);
    //             }
    //             console.log(node);

    //         }
    //     })(node)
    // })
    // stack.push(treeNodes);
    // console.log(stack)
    // for(var j=0;j<stack.length;j++){
    //     for(var i=0;i<stack[j].length;i++){
    //         console.log(stack[j][i])
    //         if(!!stack[j][i].children){
    //             stack.push(stack[j][i].children);
    //         }
    //     }
    // }
    // console.log(stack);
    // console.log(treeNodes);
    // 
    // 
    // 
    //[0,1,2]
    //[0,1,2,9]
    //[0,1,3]

    // (function() {
    //     var stack = [];
    //     level = 0;
    //     treeNodes.forEach(function(node, i) {
    //         (function(node) {
    //             var hasChildren = !!node.children;
    //             level++;
    //             if (!hasChildren) {
    //                 level--;
    //                 return false;
    //             }
    //             if (level <= 4) {
    //                 node.open = true;
    //             }
    //             // stack[node.pId]
    //             for (var i = 0; i < node.children.length; i++) {
    //                 arguments.callee.call(this, node.children[i]);
    //             }
    //             level--;
    //             // console.log(pIds);
    //         })(node)
    //     })
    //     console.log(level);
    // })()
    // console.log(treeNodes);
    </script>
</body>

</html>
